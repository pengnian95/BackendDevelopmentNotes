# volatile

## 对比synchronized
1. **volatile**本质是告诉JVM，当前变量在**寄存器（工作内存）**中的值是不确定的，需要从**主内存**中读取。
2. **synchronized**锁定当前变量，不允许其他线程访问。

## 作用
1. 保证共享变量的**可见性**。
2. 禁止**指令重排**优化。
3. 并不能保证**原子性**

## volatile & synchronized
1. volatile仅能使用在变量级别，synchronized可以使用在变量、方法、类级别。
2. volatile只能实现变量的*修改可见性*，不能保证*原子性*。synchronized可以保证*原子性*。
3. volatile不会造成*线程堵塞*。
4. volatile不会被*编译器优化*，效率较低。

## 实现原理
1. volatile变量修饰的共享变量，在进行写操作的时候会多出一个**lock**前缀的汇编指令。
2. 当对其进行写操作时，JVM就会向处理器发送一条Lock前缀的指令，把这个变量所在的缓存行的数据写回到系统内存。
3. 处理器会根据MESI**缓存一致性协议**来保证多CPU下的各个高速缓存中的数据的一致性(让其他CPU缓存中的该变量无效）。