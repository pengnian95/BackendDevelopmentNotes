# CAS

compare-and-swap
## 锁机制存在的问题
1. 在多线程竞争下，加锁、释放锁会导致比较多的上下文切换和调度延时，引起性能问题。
2. 一个线程持有锁会导致其它所有需要此锁的线程挂起。
3. 如果一个优先级高的线程等待一个优先级低的线程释放锁会导致优先级倒置，引起性能风险。

## 流程
1. CAS 操作包含三个操作数 —— 内存位置（V）、预期原值（A）和新值(B)。 
2. 如果内存位置的值与预期原值相匹配，那么处理器会自动将该位置值更新为新值 。否则，处理器不做任何操作。
3. 无论哪种情况，它都会在 CAS 指令之前返回该 位置的值。
> CAS 有效地说明了“我认为位置 V 应该包含值 A；如果包含该值，则将 B 放到这个位置；否则，不要更改该位置，只告诉我这个位置现在的值即可。”

## CAS存在的问题
1. ABA问题。
2. 循环时间开销大。
3. 只能保证一个共享变量的原子操作。