# 编译
#3. JVM/类加载/编译#
- - - -
[java编译过程（字节码编译和即时编译） - 假程序猿 - 博客园](https://www.cnblogs.com/straybirds/p/8513870.html)

## javac编译
1. 词法、语法分析
* 词法分析是将源代码的字符流转变为标记（Token）集合。
> **单个字符**是程序编写过程中的的最小元素，而**标记**则是编译过程的最小元素，关键字、变量名、字面量、运算符等都可以成为标记。比如整型标志int由三个字符构成，但是它只是一个标记，不可拆分。  
* 语法分析是根据Token序列来构造抽象语法树的过程。
> **抽象语法树**是一种用来描述程序代码语法结构的树形表示方式，语法树的每一个节点都代表着程序代码中的一个语法结构，如类型、修饰符、运算符等。  
* 经过这个步骤后，编译器就基本不会再对源码文件进行操作了，后续的操作都建立在抽象语法树之上。

2. 填充符号表
* 符号表是由一组符号地址和符号信息构成的表格。
* 符号表中所登记的信息在编译的不同阶段都要用到，在语义分析（后面的步骤）中，符号表所登记的内容将用于语义检查和产生中间代码。
* 在目标代码生成阶段，对符号名进行地址分配时，符号表是地址分配的依据。
* 比如：默认构造器的添加。

3. 语义分析
* 语法树能表示一个结构正确的源程序的抽象，但无法保证源程序是符合逻辑的。
* 而语义分析的主要任务是：对结构上正确的源程序进行上下文有关性的审查。
* 语义分析过程分为标注检查和数据及控制流分析两个步骤：
	1. 标注检查的内容包括诸如：变量使用前是否已被声明、变量和赋值之间的数据类型是否匹配等。
	2. 数据及控制流分析是对程序上下文逻辑更进一步的验证，
* 检查出诸如:程序局部变量在使用前是否有赋值、方法的每条路径是否都有返回值、是否所有的受查异常都被正确处理了等问题。

4. 字节码生成
* 字节码生成是Javac编译过程的最后一个阶段。
* 字节码生成阶段不仅仅是把前面各个步骤所生成的信息转化成字节码写到磁盘中，编译器还进行了少量的代码添加和转换工作。
* 实例构造器<init>（）方法和类构造器<clinit>（）方法就是在这个阶段添加到语法树之中的
* 如果用户代码中没有提供任何构造函数，那编译器会自动添加一个没有参数、访问权限与当前类一致的默认构造函数，这个工作在填充符号表阶段就已经完成了。


## JIT编译
* 当虚拟机发现某个方法或代码块运行特别频繁时，就会把这些代码认定为“Hot Spot Code”（热点代码），
* 为了提高热点代码的执行效率，在运行时，虚拟机将会把这些代码编译成与本地平台相关的机器码，并进行各层次的优化，完成这项任务的正是JIT编译器。

