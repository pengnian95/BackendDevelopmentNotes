# 持久化

Redis是内存型数据库，需要将数据持久化到硬盘上。
Redis默认是只开启RDB，当Redis重启时，它会优先使用AOF文件来还原数据集。
两种持久化：RDB、AOF
- RDB：对Redis中数据执行周期性的持久化
- AOF：对于每条写入命令作为日志，以append-only模式写入一个日志文件中（更加完整）
- Redis重启后，通过回放AOF日志中的指令重新构建数据集
- AOF大到一等程度后，rewrite操作，构建更小的AOF文件

## RDB快照
将某个时间点的所有数据都存放到硬盘上。
- 优点：（冷备）
	1. 生成多个数据文件，适合冷备。AOF需要写脚本处理。
	2. RDB对Redis性能影响小，fork子进行进行RDB持久化
	3. RDB重启恢复速度快
- 缺点：
	1. 恢复效果差，数据丢失
	2. fork子进程时，数据文件特别大，会对客户端服务暂停数毫秒

## AOF
append-only-file（append：附加）
将写命令添加到 AOF 文件（Append Only File）的末尾。
- 优点：
	1. 保护数据不丢失
	2. append-only写入，没有磁盘寻址开销，写入性能高，文件不易损坏
	3. AOF日志文件过大rewrite对客户端读写性能影响小
	4. 日志文件可读
- 缺点：
	1. 日志文件大
	2. 支持的写QPS低
	3. 健壮性低