# 概述

ZooKeeper是由Yahoo开发的，用于**分布式中一致性处理**的框架。最初其作为研发Hadoop时的副产品。由于_分布式系统中一致性处理较为困难_，其他的分布式系统没有必要重复造轮子，故随后的分布式系统中大量应用了ZooKeeper，以至于ZooKeeper成为了各种分布式系统的基础组件。Hadoop、Kafka、Dubbo 都是基于ZooKeeper而构建。

Zookeeper是一个分布式协调服务，可用于_服务发现，分布式锁，分布式领导选举、配置管理等_。Zookeeper提供了一个类似于Linux文件系统的树形结构（可认为是轻量级的内存文件系统，但只适合存少量信息，完全不适合存储大量文件或者大文件），同时提供了对于每个节点的监控与通知机制。

## 节点模型

![][image-1]

其节点有如下特性：
1. 同一时刻多台机器创建同一个节点，只有一个会争抢成功。利用这个特性可以做[分布式锁][1]。
2. 临时节点的生命周期与会话一致，会话关闭则临时节点删除。这个特性经常用来做*心跳，动态监控，负载等动作*。
3. 顺序节点保证节点名全局唯一。这个特性可以用来生成分布式环境下的**全局自增长id**。


## 原语功能
1. 创建节点
2. 删除节点
3. 更新节点
4. 获取节点信息
5. 权限控制
6. 事件监听


## 应用
1. **数据发布订阅**。即注册中心，见上面Dubbo用法。主要通过对节点管理做到发布以及事件监听做到订阅。
2. **负载均衡**。见上面kafka用法。
3. **命名服务**。zookeeper的节点结构天然支持命名服务，即把信息集中存储，并以树状管理，方便统一查阅。
4. **分布式协调通知**。协调通知实际上与发布订阅类似，由于引入的第三方的zookeeper，实际上对很多种协调通知做了解耦，比如参考文献4中提到的消息推送，心跳检测等。
5. **集群管理与master选举**。通过上面的第二点特性，可以轻易得知集群机器存活状况，从而轻松管理集群；通过上面第一点特性，可以做出master争抢。
6. **分布式锁**。实际上就是第一点特性的应用。
7. **分布式队列**。实际上就是第三点特性的应用。
8. **分布式的并发等待**。类似于多线程的join问题，主任务的执行依赖于其他子任务全部执行完毕，在单机多线程里可以用join，但是分布式环境下如何实现呢。利用zookeeper，可以创建一个主任务节点，旗下子任务一旦执行完毕，则在主任务节点下挂一个子任务节点，等节点数量足够，则认为主任务可以开始执行。

## 部署方式
* 单机部署：一台集群上运行；
* 集群部署：多台集群运行；
* 伪集群部署：一台集群启动多个ZooKeeper实例运行。

[1]:	ulysses://x-callback-url/open?id=yFiVzPlMtIDs5eMuQbuPcA

[image-1]:	https://raw.githubusercontent.com/zhangpengnian/ImageRepository/master/img/20191021152831.jpg